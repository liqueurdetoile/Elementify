<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/elements/inputelement.js | elementify</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-styles.css"><script src="./inject/script/0-docs.js"></script><meta name="description" content="Ultra lightweight vanilla JS library for DOM and events manipulation, form manipulation and data validation"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="elementify"><meta property="twitter:description" content="Ultra lightweight vanilla JS library for DOM and events manipulation, form manipulation and data validation"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/liqueurdetoile/elementify.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/collection.js~Collection.html">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/element.js~Element.html">Element</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-load">load</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Q">Q</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ForEachCallback">ForEachCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-InputRuleCallback">InputRuleCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-InputValidationRules">InputValidationRules</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-KeyValueObject">KeyValueObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-NodeMetrics">NodeMetrics</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors">CSSSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/fr/docs/Web/API/DOMRect">DOMRect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/fr/docs/Web/API/Element">Element</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/fr/docs/Web/API/Node">Node</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://liqueurdetoile.github.io/DotObjectArray/">ObjectArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">RegExp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#elements">elements</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/documentelement.js~DocumentElement.html">DocumentElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/eventifiedelement.js~EventifiedElement.html">EventifiedElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/formelement.js~FormElement.html">FormElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/htmlelement.js~HtmlElement.html">HtmlElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/inputelement.js~InputElement.html">InputElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/windowelement.js~WindowElement.html">WindowElement</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#events">events</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/events/eventsmanager.js~EventsManager.html">EventsManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-complete">complete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ready">ready</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utilities">utilities</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hash">hash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-uniqid">uniqid</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/elements/inputelement.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
*  @file Input Element definition class
*  @author  Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
*  @license Apache-2.0 {@link https://www.apache.org/licenses/LICENSE-2.0}
*/

import ObjectArray from &apos;dot-object-array&apos;;
import HtmlElement from &apos;elements/htmlelement&apos;;
import Q from &apos;query&apos;;
import uniqid from &apos;utilities/uniqid&apos;;

/**
*  InputElement is the common basic class wrapping all vanilla HTML inputs.
*  It provides all properties and method to :
*  - get/set Element value
*  - reset Element value
*  - validate Element value
*
*  @version 1.0.0
*  @since 1.0.0
*  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
*/

export default class InputElement extends HtmlElement {
  /**
  *  InputElement constructor
  *  Node and options are passed through {@link Element} call.
  *
  *  If the Element have required or pattern atributes, validation
  *  rules will be automatically set accordingly.
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @private
  *
  *  @param {Element} node Input element
  *  @param {KeyValueObject} options Options for the InputElement
  *
  *  Specific keys are :
  *
  *  - `value`: initial value of the Element
  *  - `options`: list of options {value: text} for a select tag
  *
  *  @returns {InputElement}
  *  @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement
  */
  constructor(node, options = {}) {
    options.type = options.type || &apos;text&apos;;

    super(node, options);

    /**
    *  Rules for validation
    *
    *  @type {ObjectArray}
    *  @since 1.0.0
    */
    this._rules = new ObjectArray();

    /**
    *  Errors after validation
    *
    *  @type {ObjectArray}
    *  @since 1.0.0
    */
    this._errors = new ObjectArray();

    // Add input type to Textarea and Select for further switch operations
    if (this.node.nodeName === &apos;TEXTAREA&apos;) this.type = &apos;textarea&apos;;
    if (this.node.nodeName === &apos;SELECT&apos;) {
      this.type = &apos;select&apos;;
      // Generates options items
      if (options.options) {
        for (let key in options.options) {
          this.append(`&lt;option value=&quot;${key}&quot; ${key === options.value ? &apos;selected&apos; : &apos;&apos;}&gt;` +
                      `${options.options[key]}` +
                      &apos;&lt;/option&gt;&apos;);
        }
      }
    }

    // Set value
    if (options.value !== undefined) {
      this.value = this.node.defaultValue = options.value;
    }

    // Set validation rules
    if (this.attr(&apos;required&apos;)) this.rule(&apos;required&apos;);
    if (this.attr(&apos;pattern&apos;)) this.rule(&apos;patternAttribute&apos;, this.attr(&apos;pattern&apos;), null, true);
    this.rule(this.attr(&apos;type&apos;));
  }

  /**
  *  Get a unique name
  *  - `name`attribute value
  *  - `id` attribute value if name not set
  *  - A random unique id if both name and value are not set
  *
  *  @type {string}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  get name() {
    let name = this.node.name || this.node.id;

    if (name === &apos;&apos;) name = &apos;input-&apos; + uniqid();
    return name;
  }

  /**
  *  Get standardized lowercased type attribute
  *
  *  @type {string}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  get type() {
    return (this.attr(&apos;type&apos;) || &apos;text&apos;).toLowerCase();
  }

  /**
  *  Set input type attribute
  *
  *  @type {string}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  set type(t) {
    this.attr(&apos;type&apos;, t);
  }

  /**
  *  Get value
  *
  *  It normalizes the behaviour for boolean inputs (radio &amp; checkbox) :
  *  - If no value attribute is set, it will return `true` or `false`
  *  - If a value attribute is set, it will return undefined and will be
  *  skipped in fields list if not checked or returns its value otherwise.
  *
  *  @type {boolean|string|undefined}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @todo
  *  - Add more casting (all values are considered as string when extracted)
  */
  get value() {
    var ret;

    switch (this.type) {
      case &apos;checkbox&apos; :
      case &apos;radio&apos; :
        if (typeof this.attr(&apos;value&apos;) !== &apos;undefined&apos; &amp;&amp; this.attr(&apos;value&apos;) !== null) {
          ret = (this.node.checked ? this.attr(&apos;value&apos;) : undefined);
        } else ret = this.node.checked;
        break;
      default:
        ret = (this.node.value || &apos;&apos;).trim();
        break;
    }
    return ret;
  }

  /**
  *  Set value
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  set value(val) {
    val = (String(val)).trim();

    switch (this.type) {
      case &apos;textarea&apos;: // Update textarea content
        this.element.value = val;
        this.html(val);
        break;
      case &apos;select&apos;: // Validate value is an option
        let o, n = 1;

        while ((o = this.child(n++)).length &amp;&amp; val !== o.value);
        if (o.length) this.value = val;
        break;
      default:
        this.element.value = val;
        break;
    }
  }

  /**
  *  Get/Set value. It&apos;s a chainable alias for the getter/setter
  *  properties
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {number|string} [v] Value to set
  *  @returns {this|boolean|string|undefined}
  *  @see {@link value}
  */
  val(v) {
    if (typeof v !== &apos;undefined&apos; &amp;&amp; v !== null) {
      this.value = v;
      return this;
    }
    return this.value;
  }

  /**
  *  Dirty state
  *
  *  Will be `true` if field value/state have changed
  *  `false` otherwise
  *
  *  @type {boolean}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @see https://www.sitepoint.com/detect-html-form-changes/
  */
  get dirty() {
    if (
      this.type === &apos;checkbox&apos; ||
      this.type === &apos;radio&apos;
    ) return this.node.checked !== this.node.defaultChecked;
    else if (this.type === &apos;select&apos;) {
      let c = false, def = 0, o, ol, opt;

      for (o = 0, ol = this.node.options.length; o &lt; ol; o++) {
        opt = this.node.options[o];
        c = c || (opt.selected !== opt.defaultSelected);
        if (opt.defaultSelected) def = o;
      }
      if (c &amp;&amp; !this.node.multiple) c = (def !== this.node.selectedIndex);
    }
    return this.value !== this.node.defaultValue;
  }

  /**
  *  Add a validation rule. Some presets are available :
  *
  *  - `required` : Value must be not empty. Add a `required` attribute to the Element
  *  - `sameas` : Value must be the same than another field. __You must
  *  provide a CSS Selector to query this field as second argument__
  *  - `int` : Strict integer (only numbers)
  *  - `number` : Decimal number (with dot). Change Element type attribute to `number`
  *  - `email` : E-mail pattern. Change Element type attribute to `email`
  *
  *  For custom error messages when validating through browser or programmatically,
  *  you can set the title attribute of the InputElement or provide a message when
  *  creating rule.
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {string}  name  Name of the rule (preset or custom)
  *  @param {string|RegExp|CSSSelector|InputRuleCallback} [pattern]
  *  - Presets will usually don&apos;t require this value
  *  - For preset `sameas`, you must provide the required CSS selector
  *  to find the other Element in order to check value.
  *  - For custom rule, you can provide a valid RegExp object or a callback. Any other value
  *  will be evaluated as a RegExp if fourth parameter is set to `true`.
  *  @param {string}  [message]   A message linked to a non validated rule can be store here
  *  @param {boolean} [evaluate = false]  If `true`, the method will try to evaluate
  *  `pattern`parameter as a regular expression. If `false`, it will simply don&apos;t create rule
  *  if `pattern` is not a {@link Function} or a {@link RegExp}.
  *  @returns {this} Chainable
  *  @todo  Add more presets
  */
  rule(name, pattern, message, evaluate = false) {
    // Presets
    switch (name) {
      case &apos;required&apos;:
        this._rules.push(&apos;required.pattern&apos;, /^(?!\s*$).+/);
        this._rules.push(&apos;required.message&apos;, message || &apos;FIELD_REQUIRED&apos;);
        this.attr(&apos;required&apos;, &apos;required&apos;);
        break;
      case &apos;sameas&apos;:
        this._rules.push(&apos;sameas.pattern&apos;, pattern);
        this._rules.push(&apos;sameas.message&apos;, message || (&apos;FIELD_NOT_MATCHING_&apos; + pattern));
        break;
      case &apos;int&apos;:
        this._rules.push(&apos;int.pattern&apos;, /^\-?\d+$/);
        this._rules.push(&apos;int.message&apos;, message || &apos;FIELD_NOT_INT&apos;);
        this.type = &apos;number&apos;;
        break;
      case &apos;number&apos;:
        this._rules.push(&apos;number.pattern&apos;, /^\-?\d+\.?\d*$/);
        this._rules.push(&apos;number.message&apos;, message || &apos;FIELD_NOT_DECIMAL&apos;);
        this.type = &apos;number&apos;;
        break;
      case &apos;email&apos;:
        this._rules.push(&apos;email.pattern&apos;, /^(([^&lt;&gt;()\[\]\\.,;:\s@&quot;]+(\.[^&lt;&gt;()\[\]\\.,;:\s@&quot;]+)*)|(&quot;.+&quot;))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/); //eslint-disable-line
        this._rules.push(&apos;email.message&apos;, message || &apos;FIELD_NOT_EMAIL&apos;);
        this.type = &apos;email&apos;;
        break;
      default:
        if (pattern instanceof Function) {
          this._rules.push(name + &apos;.callback&apos;, pattern);
          this._rules.push(name + &apos;.message&apos;, message);
        } else if (pattern instanceof RegExp || evaluate) {
          this._rules.push(name + &apos;.pattern&apos;, new RegExp(pattern));
          this._rules.push(name + &apos;.message&apos;, message);
        }
    }
    return this;
  }

  /**
  *  Export rules set on the Element
  *
  *  @type {InputValidationRules}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  get rules() {
    return this._rules.data;
  }

  /**
  *  Import rules set on the Element
  *
  *  @type {InputValidationRules}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  set rules(rules) {
    this._rules.import(rules);
  }

  /**
  *  Validate the field against the rules. Any errors will be logged
  *  in {@link errors} property.
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @returns {boolean} `true`if field validates, `false` otherwise.
  */
  validate() {
    // Reset errors
    this._errors.empty();

    // fix : Some older browsers may returns the placeholder as value
    if (this.value === this.attr(&apos;placeholder&apos;)) this.value = &apos;&apos;;

    return this._rules.reduce(function (validate, v, k) {
      if (k === &apos;sameas&apos;) validate = this.value === Q(v.pattern).value;
      else if (v.pattern) validate = v.pattern.test(this.value);
      else validate = v.callback.call(this, this);
      if (!validate) this._errors.push(k, v.message || this.attr(&apos;title&apos;));
      return validate;
    }.bind(this), true);
  }

  /**
  *  Fetch validation errors
  *
  *  @type {Object}
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  get errors() {
    return this._errors.data;
  }

  /**
  *  Returns a label HtmlElement linked to this inputElement
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {string} t Text for label
  *  @param {KeyValueObject} o Options for HtmLElement
  *  @returns {HtmlElement} Label
  */
  label(t, o) {
    return Q(`+&lt;label for=&quot;${this.name}&quot;&gt;${t}&lt;/label&gt;`, o);
  }

  /**
  *  Returns a tooltip HtmlElement linked to this inputElement
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {$type} t Text for tooltip
  *  @param {KeyValueObject} o Options for HtmLElement
  *  @returns {HtmlElement} Tooltip
  */
  tooltip(t, o) {
    return Q(`+&lt;span data-type=&quot;tooltip&quot; data-for=&quot;${this.name}&quot;&gt;${t}&lt;/span&gt;`, o);
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
